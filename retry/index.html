<!doctype html><html><head><meta charset=utf-8><meta name=generator content="Hugo 0.64.0"><link href="https://fonts.googleapis.com/css?family=Chivo|Fira+Code|Noto+Sans&display=swap" rel=stylesheet><link rel="shortcut icon" href=../images/spider-web.png><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light only"><meta name=supported-color-schemes content="light only"><title>リトライロジック&nbsp;&ndash;&nbsp;Istio By Example</title><link rel=stylesheet href=../css/core.min.c21544ff2a034abc45c53862bc2905af5c563887f811bc35b5faa39fb144a3339505a8f8c3e4250a49571f9cac22a64e.css integrity=sha384-whVE/yoDSrxFxThivCkFr1xWOIf4Ebw1tfqjn7FEozOVBaj4w+QlCklXH5ysIqZO><meta property="og:title" content="リトライロジック"><meta property="og:description" content="マイクロサービスアーキテクチャは分散されています。これは、ネットワーク上のリクエストが増えることを意味し、ネットワークの輻輳などの一時的な障"><meta property="og:type" content="article"><meta property="og:url" content="/retry/"><meta property="og:image" content="/images/istio-framed.jpg"><meta property="article:published_time" content="2019-12-31T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-06T21:50:25+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/istio-framed.jpg"><meta name=twitter:title content="リトライロジック"><meta name=twitter:description content="マイクロサービスアーキテクチャは分散されています。これは、ネットワーク上のリクエストが増えることを意味し、ネットワークの輻輳などの一時的な障"></head><body><div class="base-body max-width"><section id=header class="header max-body-width"><p><a class=home href=../><img class=site-logo src=../images/istio-logo.png alt>
<span class=site-name>Istio By Example</span></a></p></section><div id=content class="flex-body max-body-width"><section class=article-header><h1 class=article-title>リトライロジック</h1></section><div class=flex-body><article class=markdown-body><p>マイクロサービスアーキテクチャは分散されています。これは、ネットワーク上のリクエストが増えることを意味し、ネットワークの輻輳などの一時的な障害の可能性が高まります。</p><p>リクエストにリトライポリシーを追加すると、サービスアーキテクチャの回復性を構築するのに役立ちます。多くの場合、このリトライロジックは<a href=https://upgear.io/blog/simple-golang-retry-function/ target=_blank>ソースコードに組み込まれて</a>います。しかし、Istioでは、<a href=https://istio.io/docs/concepts/traffic-management/#set-number-and-timeouts-for-retries target=_blank>トラフィックルール</a>を使用してリトライポリシーを定義して、このロジックをサービスの<a href=https://istio.io/docs/concepts/what-is-istio/#architecture target=_blank>サイドカープロキシ</a>に任せることができます。これは、多くのサービス、プロトコル、およびプログラミング言語にわたって同じポリシーを中心に標準化するのに役立ちます。</p><p><a target=_blank rel="noopener noreferrer" href=../images/retry.png><img class=img src=../images/retry.png alt=Diagram></a></p><p>この例では、<code>helloworld</code> サービスへのすべての内向きのリクエストが5回試行され、完了までに2秒以上かかる場合、試行は失敗としてマークされます。</p><div class=highlight><pre class=chroma><code class=language-YAML data-lang=YAML><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>networking.istio.io/v1alpha3<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>DestinationRule<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>helloworld<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>host</span><span class=p>:</span><span class=w> </span>helloworld<span class=w>
</span><span class=w>  </span><span class=k>subsets</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>v1<span class=w>
</span><span class=w>    </span><span class=k>labels</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>      </span><span class=k>version</span><span class=p>:</span><span class=w> </span>v1<span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-YAML data-lang=YAML><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>networking.istio.io/v1alpha3<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>VirtualService<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>helloworld<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>hosts</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span>- helloworld<span class=w>
</span><span class=w>  </span><span class=k>http</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span>- <span class=k>route</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>    </span>- <span class=k>destination</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>        </span><span class=k>host</span><span class=p>:</span><span class=w> </span>helloworld<span class=w>
</span><span class=w>        </span><span class=k>subset</span><span class=p>:</span><span class=w> </span>v1<span class=w>
</span><span class=w>    </span><span class=k>retries</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>      </span><span class=k>attempts</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span><span class=w>      </span><span class=k>perTryTimeout</span><span class=p>:</span><span class=w> </span>2s<span class=w>
</span></code></pre></div></article></div><section id=footer class=footer><p>Made with ❤️ by <a href=https://twitter.com/askmeegs>Megan O'Keefe</a> | <a href=https://github.com/askmeegs/istiobyexample>Source</a> | <a href=https://github.com/cntrump/hugo-notepadium>Theme</a></p></section></div></div></body></html>