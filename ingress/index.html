<!doctype html><html><head><meta charset=utf-8><title>Ingress&nbsp;&ndash;&nbsp;Istio By Example (ja)</title><link href="https://fonts.googleapis.com/css?family=Chivo|Fira+Code|Noto+Sans&display=swap" rel=stylesheet><link rel="shortcut icon" href=../images/spider-web.png><link rel=stylesheet href=https://istiobyexample-ja.github.io/istiobyexample/css/core.min.1ec2f555efc6ec0b36a9bbdf72319cf586f948899f24ab0ef5c93c82bbc7987b1eb704efe0b3a4dad22677058a40e6f6.css integrity=sha384-HsL1Ve/G7As2qbvfcjGc9Yb5SImfJKsO9ck8grvHmHsetwTv4LOk2tImdwWKQOb2><meta name=generator content="Hugo 0.64.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light only"><meta name=supported-color-schemes content="light only"><meta property="og:title" content="Ingress"><meta property="og:description" content="Ingress トラフィックはクラスター外からメッシュへ入ってくるトラフィックのことを指します。 Kubernetes は Ingress トラフィックを扱う方法を LoadBalancer タイプ や Ingress で提供しています"><meta property="og:type" content="article"><meta property="og:url" content="https://istiobyexample-ja.github.io/istiobyexample/ingress/"><meta property="og:image" content="https://istiobyexample-ja.github.io/istiobyexample/images/opengraph.png"><meta property="article:published_time" content="2019-12-31T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-27T22:41:03+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://istiobyexample-ja.github.io/istiobyexample/images/opengraph.png"><meta name=twitter:title content="Ingress"><meta name=twitter:description content="Ingress トラフィックはクラスター外からメッシュへ入ってくるトラフィックのことを指します。 Kubernetes は Ingress トラフィックを扱う方法を LoadBalancer タイプ や Ingress で提供しています"></head><body><div class="base-body max-width"><section id=header class="header max-body-width"><p><a class=home href=../><img class=site-logo src=../images/istio-logo.png alt>
<span class=site-name>Istio By Example</span></a></p><p>本サイトは <a href=https://istiobyexample.dev>Istio By Example</a> の和訳です</p></section><div id=content class="flex-body max-body-width"><section class=article-header><h1 class=article-title>Ingress</h1></section><div class=flex-body><article class=markdown-body><p>Ingress トラフィックはクラスター外からメッシュへ入ってくるトラフィックのことを指します。 Kubernetes は Ingress トラフィックを扱う方法を <a href=https://kubernetes.io/ja/docs/concepts/services-networking/service/#loadbalancer target=_blank>LoadBalancer タイプ</a> や <a href=https://kubernetes.io/ja/docs/concepts/services-networking/ingress/ target=_blank>Ingress</a>
で提供しています。
Istio では、代わりに <strong>Gateway</strong> で Ingress トラフィック を管理することができます。</p><p><a href=https://istio.io/docs/reference/config/networking/v1alpha3/gateway/ target=_blank>Gateway</a> はクラスターへ到着するトラフィックのロードバランシングを担う Envoy プロキシです。Istio はパブリックIPを持ったデフォルトの <code>IngressGateway</code> をデプロイします。これを使用することで、サービスメッシュ内のアプリケーションをインターネットに公開することができます。</p><p>Istio の Gateway は Kubernetes の Igress に比べて２つの点で優れています。 Gateway は Envoy プロキシです。そのため Istio を使用することで、 East-West トラフィックと同じように Gateway トラフィックを扱うことができます(トラフィックスプリットやリダイレクト、リトライなど)。</p><p>また Gateways は、<a href=https://istio.io/docs/concepts/what-is-istio/#envoy target=_blank>サイドカー</a> と同じようにリクエストレートやエラーレートなどのメトリクスを転送します。これにより<a href=https://istio.io/docs/tasks/telemetry/kiali/#generating-a-service-graph target=_blank>サービスグラフ</a>でIngress トラフィックを見ることや、クライアントに直接配信しているフロントエンドサービスの細かい<a href=https://landing.google.com/sre/sre-book/chapters/service-level-objectives/ target=_blank>SLOs</a>を設定することができます。</p><p>では実際に Gateways を見てみましょう。</p><p><a target=_blank rel="noopener noreferrer" href=../images/ingress.png><img class=img src=../images/ingress.png alt=ingress></a></p><p>ここでは <code>hello</code> アプリケーションが Pod 内のコンテナとして動いています。Pod には Istio のサイドカープロキシが挿入されています。<code>hello</code> という Kubernetes のサービスがこの Pod に向けられています。<code>hello.com</code> から入ってくるトラフィックをこの <code>hello</code> サービスに向けたいと思います。</p><p>まず Istio デフォルトの <code>IngressGateway</code> 内に <code>hello.com</code> ドメインから名前解決された ポート <code>80</code> を開放する <code>Gateway</code> リソースが必要です。</p><div class=highlight><pre class=chroma><code class=language-YAML data-lang=YAML><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>networking.istio.io/v1alpha3<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>Gateway<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>hello-gateway<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>selector</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>    </span><span class=k>istio</span><span class=p>:</span><span class=w> </span>ingressgateway<span class=w> </span><span class=c># デフォルトの IngressGateway を使用します</span><span class=w>
</span><span class=w>  </span><span class=k>servers</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span>- <span class=k>port</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>      </span><span class=k>number</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span><span class=w>      </span><span class=k>name</span><span class=p>:</span><span class=w> </span>http<span class=w>
</span><span class=w>      </span><span class=k>protocol</span><span class=p>:</span><span class=w> </span>HTTP<span class=w>
</span><span class=w>    </span><span class=k>hosts</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>    </span>- <span class=s2>&#34;hello.com&#34;</span><span class=w>
</span></code></pre></div><p>(<strong>注意</strong>: <code>IngressGateway</code> の外部IPアドレスに対しては自身でDNSの名前解決をする必要があります。</p><p>次に <code>IngressGateway</code> から <code>default</code> の Namespace にポート <code>80</code> で動いている <code>hello</code> のバックエンドサービスにトラフィックを向ける <a href=https://istio.io/docs/tasks/traffic-management/ingress/ingress-control/ target=_blank><code>VirtualService</code></a> を用意します。</p><div class=highlight><pre class=chroma><code class=language-YAML data-lang=YAML><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>networking.istio.io/v1alpha3<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>VirtualService<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>frontend-ingress<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>hosts</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span>- <span class=s2>&#34;hello.com&#34;</span><span class=w>
</span><span class=w>  </span><span class=k>gateways</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span>- hello-gateway<span class=w>
</span><span class=w>  </span><span class=k>http</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span>- <span class=k>route</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>    </span>- <span class=k>destination</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>        </span><span class=k>host</span><span class=p>:</span><span class=w> </span>hello.default.svc.cluster.local<span class=w>
</span><span class=w>        </span><span class=k>port</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>          </span><span class=k>number</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></code></pre></div></article></div><section id=footer class=footer><p>Made with ❤️ by <a href=https://twitter.com/askmeegs>Megan O'Keefe</a> | <a href=https://github.com/askmeegs/istiobyexample>Source</a> | <a href=https://github.com/cntrump/hugo-notepadium>Theme</a></p><p>Localized by <a href=https://github.com/istiobyexample-ja/istiobyexample>Istio by Example-ja Project</a></p></section></div></div></body></html>