<!doctype html><html><head><meta charset=utf-8><title>負荷分散&nbsp;&ndash;&nbsp;Istio By Example (ja)</title><link href="https://fonts.googleapis.com/css?family=Chivo|Fira+Code|Noto+Sans&display=swap" rel=stylesheet><link rel="shortcut icon" href=../images/spider-web.png><link rel=stylesheet href=../istiobyexample/istiobyexample/css/core.min.1ec2f555efc6ec0b36a9bbdf72319cf586f948899f24ab0ef5c93c82bbc7987b1eb704efe0b3a4dad22677058a40e6f6.css integrity=sha384-HsL1Ve/G7As2qbvfcjGc9Yb5SImfJKsO9ck8grvHmHsetwTv4LOk2tImdwWKQOb2><meta name=generator content="Hugo 0.64.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light only"><meta name=supported-color-schemes content="light only"><meta property="og:title" content="負荷分散"><meta property="og:description" content="Kubernetesは、クラスタに入ってくるトラフィックの負荷分散をサポートしています。しかし、クラスター内のKubernetes Servi"><meta property="og:type" content="article"><meta property="og:url" content="https://istiobyexample-ja.github.io/istiobyexample/load-balancing/"><meta property="og:image" content="https://istiobyexample-ja.github.io/istiobyexample/images/opengraph.png"><meta property="article:published_time" content="2019-12-31T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-09T18:06:14+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://istiobyexample-ja.github.io/istiobyexample/images/opengraph.png"><meta name=twitter:title content="負荷分散"><meta name=twitter:description content="Kubernetesは、クラスタに入ってくるトラフィックの負荷分散をサポートしています。しかし、クラスター内のKubernetes Servi"></head><body><div class="base-body max-width"><section id=header class="header max-body-width"><p><a class=home href=../><img class=site-logo src=../images/istio-logo.png alt>
<span class=site-name>Istio By Example</span></a></p><p>本サイトは <a href=https://istiobyexample.dev>Istio By Example</a> を和訳したものです</p></section><div id=content class="flex-body max-body-width"><section class=article-header><h1 class=article-title>負荷分散</h1></section><div class=flex-body><article class=markdown-body><p>Kubernetesは、<a href=https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer target=_blank>クラスタに入ってくる</a>トラフィックの負荷分散をサポートしています。しかし、クラスター内のKubernetes Serviceについてはどうでしょうか？</p><p>クラスター内サービスが<a href=https://kubernetes.io/docs/concepts/services-networking/#proxy-mode-iptables target=_blank>通信</a>するとき、kube-proxyと呼ばれるロードバランサーがリクエストをService Podにランダムに<a href=https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview#services target=_blank>転送</a>します。 Istioを使用することで、Envoyがもたらす、より複雑な負荷分散方式を追加できます。</p><p>Envoyは、<a href=https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#random target=_blank>ランダム</a>、<a href=https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#weighted-round-robin target=_blank>ラウンドロビン</a>、<a href=https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#weighted-least-request target=_blank>最小リクエスト</a>など、複数の負荷分散方式をサポートしています。</p><p>Istioを使用して、Web <code>frontend</code> のすべてのトランザクションを処理する、<code>payments</code>と呼ばれるサービスの<a href=https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#weighted-least-request target=_blank><strong>最小リクエスト</strong></a>負荷分散方式を追加する方法を見てみましょう。paymentsサービスは3つのPodによって支えられています。</p><p>この最小リクエストアルゴリズムでは、クライアント側のEnvoyは最初にランダムに2つのインスタンスを選択します。次に、アクティブなリクエストの数が最も少ないインスタンスにリクエストを転送し、すべてのインスタンス間で負荷を均等に分散できるようにします。</p><p><a target=_blank rel="noopener noreferrer" href=../images/lb-least-requests.png><img class=img src=../images/lb-least-requests.png alt="load balancing"></a></p><p>この機能を有効にするには、trafficPolicyのloadBalancerに <a href=https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#LoadBalancerSettings-SimpleLB target=_blank><code>LEAST_CONN</code></a> を設定した Istio <a href=https://istio.io/docs/reference/config/networking/destination-rule/ target=_blank>DestinationRule</a>を作成します。:</p><div class=highlight><pre class=chroma><code class=language-YAML data-lang=YAML><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>networking.istio.io/v1alpha3<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>DestinationRule<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>payments-load-balancer<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>host</span><span class=p>:</span><span class=w> </span>payments.prod.svc.cluster.local<span class=w>
</span><span class=w>  </span><span class=k>trafficPolicy</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>      </span><span class=k>loadBalancer</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>        </span><span class=k>simple</span><span class=p>:</span><span class=w> </span>LEAST_CONN<span class=w>
</span></code></pre></div><p><a href=https://istio.io/docs/concepts/traffic-management/#load-balancing-3-subsets target=_blank>Istio docs</a>を参照して、単一のホストに複数の負荷分散方式を追加する方法を確認してください。</p></article></div><section id=footer class=footer><p>Made with ❤️ by <a href=https://twitter.com/askmeegs>Megan O'Keefe</a> | <a href=https://github.com/askmeegs/istiobyexample>Source</a> | <a href=https://github.com/cntrump/hugo-notepadium>Theme</a></p><p>Localized by <a href=https://github.com/istiobyexample-ja/istiobyexample>Istio by Example-ja Project</a></p></section></div></div></body></html>