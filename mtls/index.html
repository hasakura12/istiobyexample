<!doctype html><html><head><meta charset=utf-8><meta name=generator content="Hugo 0.64.0"><link href="https://fonts.googleapis.com/css?family=Chivo|Fira+Code|Noto+Sans&display=swap" rel=stylesheet><link rel="shortcut icon" href=../images/spider-web.png><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light only"><meta name=supported-color-schemes content="light only"><title>相互TLS&nbsp;&ndash;&nbsp;Istio By Example</title><link rel=stylesheet href=../css/core.min.c21544ff2a034abc45c53862bc2905af5c563887f811bc35b5faa39fb144a3339505a8f8c3e4250a49571f9cac22a64e.css integrity=sha384-whVE/yoDSrxFxThivCkFr1xWOIf4Ebw1tfqjn7FEozOVBaj4w+QlCklXH5ysIqZO><meta property="og:title" content="相互TLS"><meta property="og:description" content="マイクロサービスアーキテクチャは、ネットワーク上のリクエストが増えることと、悪意のある当事者がトラフィックを傍受する機会が増えることを意味し"><meta property="og:type" content="article"><meta property="og:url" content="/mtls/"><meta property="og:image" content="/images/istio-framed.jpg"><meta property="article:published_time" content="2019-12-31T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-05T18:10:01+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/istio-framed.jpg"><meta name=twitter:title content="相互TLS"><meta name=twitter:description content="マイクロサービスアーキテクチャは、ネットワーク上のリクエストが増えることと、悪意のある当事者がトラフィックを傍受する機会が増えることを意味し"></head><body><div class="base-body max-width"><section id=header class="header max-body-width"><p><a class=home href=../><img class=site-logo src=../images/istio-logo.png alt>
<span class=site-name>Istio By Example</span></a></p></section><div id=content class="flex-body max-body-width"><section class=article-header><h1 class=article-title>相互TLS</h1></section><div class=flex-body><article class=markdown-body><p>マイクロサービスアーキテクチャは、ネットワーク上のリクエストが増えることと、悪意のある当事者がトラフィックを傍受する機会が増えることを意味します。<a href=https://en.wikipedia.org/wiki/Mutual_authentication target=_blank>相互TLS</a>（mTLS）認証は、<a href=https://www.internetsociety.org/deploy360/tls/basics/ target=_blank>証明書</a>を使用してサービストラフィックを暗号化する方法です。</p><p>Istioを使用すると、すべてのサービスにわたるmTLSの適用を自動化できます。以下では、メッシュ全体に対してmTLSを有効にします。クラスター内の2つのPod（ <code>クライアント</code> と <code>サーバー</code> ）は、mTLSポリシーを使用してセキュアな接続を確立しているところを示しています。</p><p><a target=_blank rel="noopener noreferrer" href=../images/mtls.png><img class=img src=../images/mtls.png alt=Diagram></a></p><div class=highlight><pre class=chroma><code class=language-YAML data-lang=YAML><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>authentication.istio.io/v1alpha1<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>MeshPolicy<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>default<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>peers</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span>- <span class=k>mtls</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>      </span><span class=k>mode</span><span class=p>:</span><span class=w> </span>STRICT<span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-YAML data-lang=YAML><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>networking.istio.io/v1alpha3<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>DestinationRule<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>default<span class=w>
</span><span class=w>  </span><span class=k>namespace</span><span class=p>:</span><span class=w> </span>istio-system<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>  </span><span class=k>host</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;*.local&#34;</span><span class=w>
</span><span class=w>  </span><span class=k>trafficPolicy</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>    </span><span class=k>tls</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=w>      </span><span class=k>mode</span><span class=p>:</span><span class=w> </span>ISTIO_MUTUAL<span class=w>
</span></code></pre></div><p>ここでは、<code>MeshPolicy</code> はリクエストを受信するすべてのサービス（サーバー側）にTLSを適用し、<code>DestinationRule</code> はリクエストを送信するすべてのサービス（クライアント側）にTLSを適用し、相互（「両方」）のTLSを作成します。</p><p><strong>認証フロー：</strong></p><ol><li><code>クライアント</code> アプリケーションコンテナーはプレーンテキストのHTTPリクエストを <code>サーバー</code> に送信します。</li><li><code>クライアント</code> プロキシコンテナーが外向けのリクエストを傍受します。</li><li><code>クライアント</code> プロキシは、サーバー側プロキシとTLS<a href=https://www.ibm.com/support/knowledgecenter/en/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660_.htm target=_blank>ハンドシェイク</a>を実行します。このハンドシェイクには、証明書の交換が含まれます。これらの証明書は、Istioによってプロキシコンテナーにプリロードされます。</li><li><code>クライアント</code> プロキシは、サーバーの証明書に対して<a href=https://istio.io/docs/concepts/security/#secure-naming target=_blank>セキュアな名前付け</a>チェックを実行し、承認されたIDが <code>サーバー</code> を実行していることを確認します。</li><li><code>クライアント</code> と <code>サーバー</code> は相互TLS接続を確立し、 <code>サーバー</code> プロキシはリクエストを <code>サーバー</code> アプリケーションコンテナーに転送します。</li></ol><p><strong>詳しく学ぶ</strong>：</p><ul><li><a href=https://istio.io/docs/concepts/security/#authentication target=_blank>Istio Docs - 認証</a></li><li><a href=https://github.com/GoogleCloudPlatform/istio-samples/tree/77fb1dfb690d28517e410df2911e255d54e3450e/security-intro#authentication target=_blank>サンプル: 認証</a></li><li><a href=https://istio.io/docs/tasks/security/authentication/authn-policy/ target=_blank>タスク - 認証ポリシー</a></li><li><a href=https://istio.io/pt-br/docs/tasks/security/authentication/mutual-tls/ target=_blank>タスク - 相互TLS Deep-Dive</a></li><li><a href=https://istio.io/faq/security/#enabling-disabling-mtls target=_blank>FAQ - mTLS</a></li></ul></article></div><section id=footer class=footer><p>Made with ❤️ by <a href=https://twitter.com/askmeegs>Megan O'Keefe</a> | <a href=https://github.com/askmeegs/istiobyexample>Source</a> | <a href=https://github.com/cntrump/hugo-notepadium>Theme</a></p></section></div></div></body></html>